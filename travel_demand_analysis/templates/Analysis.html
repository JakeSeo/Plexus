
<!DOCTYPE html>
{% load staticfiles %}
<html>
<head>

    <title>VIA - Amenities Manager</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">

    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="{% static 'css/personalized.css' %}"/>
    <link type="text/css" rel="stylesheet" href="{% static 'css/materialize/css/materialize.min.css' %}"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>


    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/MarkerCluster.css"/>
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/MarkerCluster.Default.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.0/leaflet.draw.css"/>
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet-easybutton@2.0.0/src/easy-button.css">

    <script src="https://unpkg.com/leaflet-easybutton@2.0.0/src/easy-button.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/leaflet.markercluster.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.0/leaflet.draw.js"></script>
    <script src="http://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
    <script src="{% static 'leaflet/heatmap.js' %}"></script>
    <script src="{% static 'leaflet/leaflet-heatmap.js' %}"></script>
</head>

<body>
<!--Import jQuery before materialize.js-->
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="{% static 'css/materialize/js/materialize.min.js' %}"></script>


<div id="file-modal" class="modal medium-modal">
    <div class="modal-content file-select-table ">
        <table class="bordered highlight">
            <thead>
            <tr>
                <th data-field="id">Name</th>
                <th data-field="name">Date Modified</th>
            </tr>
            </thead>

            <tbody>
            <tr>
                <td>Amenities-1</td>
                <td>March 3, 2017</td>
            </tr>
            <tr>
                <td>Amenities-2</td>
                <td>March 1, 2017</td>
            </tr>
            <tr>
                <td>Amenities-3</td>
                <td>March 1, 2017</td>
            </tr>
            <tr>
                <td>Amenities-Valenzuela</td>
                <td>January 31, 2017</td>
            </tr>
            <tr>
                <td>Amenities-1</td>
                <td>March 3, 2017</td>
            </tr>
            <tr>
                <td>Amenities-2</td>
                <td>March 1, 2017</td>
            </tr>
            <tr>
                <td>Amenities-3</td>
                <td>March 1, 2017</td>
            </tr>
            <tr>
                <td>Amenities-Valenzuela</td>
                <td>January 31, 2017</td>
            </tr>
            <tr>
                <td>Amenities-1</td>
                <td>March 3, 2017</td>
            </tr>
            <tr>
                <td>Amenities-2</td>
                <td>March 1, 2017</td>
            </tr>
            <tr>
                <td>Amenities-3</td>
                <td>March 1, 2017</td>
            </tr>
            <tr>
                <td>Amenities-Valenzuela</td>
                <td>January 31, 2017</td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="modal-footer">
        <button class="modal-action modal-close waves-effect waves-green btn-flat active-btn">Add</button>
    </div>
</div>


<!--div id="file-modal" class="modal medium-modal">
  <div class="modal-content left-align">
    <h5>
      <i class="material-icons medium green-text text-accent-4 left">done</i>
      Changes successfully saved!
    </h5>
  </div>
  <div class="modal-footer">
    <button class="modal-action modal-close waves-effect waves-green btn-flat active-btn">Ok</button>
  </div>
</div-->

<ul id="dropdownData" class="dropdown-content row">
    <li><a href="#!">Amenities</a></li>
    <li class="divider"></li>
    <li><a href="#!">Households</a></li>
    <li class="divider"></li>
    <li><a href="#!">Land Use</a></li>
    <li class="divider"></li>
    <li><a href="#!">Roads</a></li>
    <li class="divider"></li>
    <li><a href="#!">Routes</a></li>
    <li class="divider"></li>
    <li><a href="#!">Stops</a></li>
    <li class="divider"></li>
    <li><a href="#!">TAZ</a></li>
</ul>

<ul id="dropdownAna" class="dropdown-content row">
    <li><a href="#!">Passenger Dispersion</a></li>
    <li class="divider"></li>
    <li><a href="#!">Road Network</a></li>
    <li class="divider"></li>
    <li><a href="#!">Robustness</a></li>
    <li class="divider"></li>
    <li><a href="#!">Route Measure Capacity</a></li>
    <li class="divider"></li>
    <li><a href="#!">Stop Network</a></li>
    <li class="divider"></li>
    <li><a href="#!">Transport Network</a></li>
    <li class="divider"></li>
    <li><a href="#!">Travel Demand</a></li>
</ul>


<nav>
    <div class="nav-wrapper row" style="background-color: black !important">
        <a href="#!" class="brand-logo col s2 left" style="margin-left: 40px !important;">Plexus</a>
        <ul class="hide-on-med-and-down col s10 right">
            <li><a class="dropdown-button" href="#!" data-activates="dropdownData">Data<i class="material-icons right">arrow_drop_down</i></a>
            </li>
            <li><a class="dropdown-button" href="#!" data-activates="dropdownAna">Analysis<i
                    class="material-icons right">arrow_drop_down</i></a></li>
        </ul>
    </div>
</nav>
<div class="row file-title-row">
    <form class="input-field col s6 input-file-name">
        <input type="text" style="border-bottom: 0 !important;" value="TravelDemand-Valenzuela">
    </form>
    <!--div class="right col s1">&nbsp;</div-->
    <a class="light-green btn right col s1" style="font-size: 12px !important; margin-left:18px !important;">Save</a>
</div>
<div class="body-content row">
    <div class="side-nav-bg col s2" style="padding:0 !important;margin:0 !important;height:100% !important;">
        <div class="row content-fields">
            <div class="row input-field col s12">
                <ul class="collection with-header">
                    <li class="collection-item" style="font-size:20px !important;">
                        <div>Amenities<a id="add-amenity-file" class="secondary-content"><i
                                class="black-text material-icons">add</i></a></div>
                    </li>
                    <div id="amenity-included-files">

                    </div>
                </ul>
            </div>
            <div class="row input-field col s12">
                <ul class="collection with-header">
                    <li class="collection-item" style="font-size:20px !important;">
                        <div>Households<a id="add-household-file" class="secondary-content"><i
                                class="black-text material-icons">add</i></a></div>
                    </li>
                    <div id="household-included-files">

                    </div>
                </ul>
            </div>
            <div class="row input-field col s12">
                <ul class="collection with-header">
                    <li class="collection-item" style="font-size:20px !important;">
                        <div>Land Use<a id="edit-landuse" class="secondary-content"><i
                                class="black-text material-icons">mode_edit</i></a></div>
                    </li>
                    <div id="landuse-included-files">

                    </div>
                </ul>
            </div>
            <div class="row input-field col s12">
                <ul class="collection with-header">
                    <li class="collection-item" style="font-size:20px !important;">
                        <div>TAZ<a id="add-trafficzone-file" class="secondary-content"><i
                                class="black-text material-icons">add</i></a></div>
                    </li>
                    <div id="trafficzone-included-files">

                    </div>
                </ul>
            </div>
        </div>
    </div>
    <!--div class = "map-bg col s8">
    </div-->

    <div id="mapid" class="col s8 main-bg"></div>

    <div class="side-nav-bg col s2">
        <div id="runanalysis" class="row" style="margin-top:20px; margin-bottom:20px !important;">
            <a id="run-analysis-btn" class="light-green btn col s10" style="font-size: 14px !important; margin-left:18px !important;">Run
                Analysis</a>
        </div>
        <div class="row">
            <div>
                <ul class="tabs" style="font-size:10px;width:100px !important;overflow-x: hidden !important;">
                    <li class="tab col s3 custom-tab"><a class="active" href="#inbox">Summary</a></li>
                    <li class="tab col s3 custom-tab"><a href="#table-zone-details">Details</a></li>
                </ul>
            </div>
        </div>
        <div class="row" id="inbox">
            <div class="row" style="margin-bottom:10px !important;">
                <div class="col s1">
                    &nbsp;
                </div>
                <table class="left-summary-table bordered col s10">
                    <tbody>
                    <tr>
                        <td>Amenities</td>
                        <td id="amenity-summary">0</td>
                    </tr>
                    <tr>
                        <td>Land Use</td>
                        <td id="landuse-summary">0</td>
                    </tr>
                    <tr>
                        <td>Households</td>
                        <td id="household-summary">0</td>
                    </tr>
                    <tr>
                        <td>Traffic Analysis Zones</td>
                        <td id="trafficzone-summary">0</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="divider"></div>

            <div class="row">
                <p class="filters-header">Filters</p>

                <p class="modes-header">Types of trips</p>
                <div class="trips-checkboxes">
                    <form action="#">
                        <p>
                          <input class="with-gap" name="group1" type="radio" id="trip-produced-radio"  />
                          <label for="trip-produced-radio">Trips Produced</label>
                        </p>
                        <p>
                          <input class="with-gap" name="group1" type="radio" id="trip-attracted-radio"  />
                          <label for="trip-attracted-radio">Trips Attracted</label>
                        </p>
                    </form>
                </div>

                <p class="modes-header">Modes of transportation</p>

                <div class="trips-checkboxes">
                    <form action="#">
                        <input type="checkbox" id="test1"/>
                        <label for="test1" class="checkbox-style"
                               style="padding-left:20px;padding-right:20px">Jeep</label>
                        <input type="checkbox" id="test2"/>
                        <label for="test2" class="checkbox-style"
                               style="padding-left:20px;padding-right:20px">Bus</label>
                    </form>
                </div>
            </div>
        </div>
        <div class="row" id="table-zone-details" style="height:500px !important; overflow-y:scroll !important;">

        </div>
    </div>
</div>
<div id="amenity-modal" class="modal medium-modal">
    <div class="row">
        <ul id="amenity-modal-ul" class="collection">

        </ul>
    </div>
    <div class="modal-footer">
        <button id="amenity-modal-ok-btn" class="modal-action modal-close waves-effect waves-green btn-flat active-btn">
            Ok
        </button>
    </div>
</div>

<div id="household-modal" class="modal medium-modal">
    <div class="row">
        <ul id="household-modal-ul" class="collection">

        </ul>
    </div>
    <div class="modal-footer">
        <button id="household-modal-ok-btn" class="modal-action modal-close waves-effect waves-green btn-flat active-btn">
            Ok
        </button>
    </div>
</div>

<div id="trafficzone-modal" class="modal medium-modal">
    <div class="row">
        <ul id="trafficzone-modal-ul" class="collection">

        </ul>
    </div>
    <div class="modal-footer">
        <button id="trafficzone-modal-ok-btn" class="modal-action modal-close waves-effect waves-green btn-flat active-btn">
            Ok
        </button>
    </div>
</div>

<div id="delete-modal" class="modal medium-modal">
    <div class="modal-content row" >
        <div class="col s12 m12 l12">
            <form action="">
                <h5 name="delete-modal-message">This file will be removed. Are you sure?</h5>
            </form>
        </div>
    </div>
     <div class="modal-footer">
        <a id="delete-file" class="modal-action waves-effect waves-green btn-flat active-btn">Remove</a>
        <a id="cancel-delete-file" class="modal-action modal-close waves-effect waves-green btn-flat green-text text-accent-4">Cancel</a>
    </div>
</div>

<div id="edit-landuse-modal" class="modal medium-modal">
    <div class="row">
        <ul id="edit-landuse-modal-ul" class="collection">
        </ul>
    </div>
    <div class="modal-footer">
        <button id="edit-landuse-modal-ok-btn" class="modal-action waves-effect waves-green btn-flat active-btn">
            Ok
        </button>
    </div>
</div>

<div id="overlay">
    <div class="preloader-wrapper big active preloader-positioning">
      <div class="spinner-layer spinner-blue">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div><div class="gap-patch">
          <div class="circle"></div>
        </div><div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>

      <div class="spinner-layer spinner-red">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div><div class="gap-patch">
          <div class="circle"></div>
        </div><div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>

      <div class="spinner-layer spinner-yellow">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div><div class="gap-patch">
          <div class="circle"></div>
        </div><div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>

      <div class="spinner-layer spinner-green">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div><div class="gap-patch">
          <div class="circle"></div>
        </div><div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>
    </div>
</div>

<!----------------------------------------------------- SCRIPTS ------------------------------------------->
<!----------------------------------------------------- SCRIPTS ------------------------------------------->
<!----------------------------------------------------- SCRIPTS ------------------------------------------->
<!----------------------------------------------------- SCRIPTS ------------------------------------------->
<!----------------------------------------------------- SCRIPTS ------------------------------------------->
<!----------------------------------------------------- SCRIPTS ------------------------------------------->

<script type="text/javascript">
        var max_attracted=0, max_produced=0, max_score_basis = 0;
        var taz_analyzed = [];

        var visualize_analyzed_layers = [];

        var visualize_amenities = [];
        var visualize_households = [];
        var visualize_trafficzones = [];
        var visualize_landuses = [];

        var visualize_amenity_layers = [];
        var visualize_household_layers = [];
        var visualize_trafficzone_layers = [];
        var visualize_landuse_layers = [];

        //zone_landuse_settings[2].setStyle({fillColor: '#800026'});
        //mymap.removeLayer(zone_landuse_settings[2]);

        var amenity_files = [];
        var amenity_summaries = [];
        var household_files = [];
        var household_summaries = [];
        var trafficzone_files = [];
        var trafficzone_summaries = [];
        var landuse_files = [];
        var landuse_summaries = [];

        var taz_name_lbl = [];
        var zonal_od = [];

        var zone_landuse_settings = ['commercial','parks','industrial','agriculture','residential',
                                     'commercial','parks','industrial','agriculture','residential',
                                     'commercial','parks','industrial','agriculture','residential',
                                     'utilities','other'];
        var landuse_categories = ['commercial','parks','industrial','agriculture','residential',
                                  'utilities','other'];
        var traffic_analysis_zones_layers = [];
        var to_delete;

        $( document ).ready(function() {
            L.Mask = L.Polygon.extend({
                options: {
                    stroke: false,
                    color: '#333',
                    fillOpacity: 0.5,
                    clickable: true,

                    outerBounds: new L.LatLngBounds([-90, -360], [90, 360])
                },

                initialize: function (latLngs, options) {

                     var outerBoundsLatLngs = [
                        this.options.outerBounds.getSouthWest(),
                        this.options.outerBounds.getNorthWest(),
                        this.options.outerBounds.getNorthEast(),
                        this.options.outerBounds.getSouthEast()
                    ];
                    L.Polygon.prototype.initialize.call(this, [outerBoundsLatLngs, latLngs], options);
                },

            });
            L.mask = function (latLngs, options) {
                return new L.Mask(latLngs, options);
            };


            $("#overlay").css("display","none");
            $.ajaxSetup({
                 beforeSend: function(xhr, settings) {
                     function getCookie(name) {
                         var cookieValue = null;
                         if (document.cookie && document.cookie != '') {
                             var cookies = document.cookie.split(';');
                             for (var i = 0; i < cookies.length; i++) {
                                 var cookie = jQuery.trim(cookies[i]);
                                 if (cookie.substring(0, name.length + 1) == (name + '=')) {
                                     cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                     break;
                                 }
                             }
                         }
                         return cookieValue;
                     }
                     if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                         xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
                     }
                 }
            });
        });

        L.LabelOverlay = (L.Layer || L.Class).extend({
            initialize: function(/*LatLng*/ latLng, /*String*/ label, options) {
                this._latlng = latLng;
                this._label = label;
                L.Util.setOptions(this, options);
            },
            options: {
                offset: new L.Point(0, 2)
            },
            onAdd: function(map) {
                this._map = map;
                if (!this._container) {
                    this._initLayout();
                }
                map.getPanes().overlayPane.appendChild(this._container);
                this._container.innerHTML = this._label;
                map.on('viewreset', this._reset, this);
                this._reset();
            },
            onRemove: function(map) {
                map.getPanes().overlayPane.removeChild(this._container);
                map.off('viewreset', this._reset, this);
            },
            _reset: function() {
                var pos = this._map.latLngToLayerPoint(this._latlng);
                var op = new L.Point(pos.x + this.options.offset.x, pos.y - this.options.offset.y);
                L.DomUtil.setPosition(this._container, op);
            },
            _initLayout: function() {
                this._container = L.DomUtil.create('div', 'leaflet-label-overlay');
            }
        });


        $('#trip-produced-radio').click(function() {
           if(taz_analyzed.length>0){
               if($('#trip-produced-radio').is(':checked')){
                   max_score_basis = max_produced;
                   for(x=0; x<visualize_analyzed_layers.length; x++){
                       visualize_analyzed_layers[x].setStyle(mystyle(taz_analyzed[x]));
                   }
               }
           }else{
               $('#trip-produced-radio').prop("checked", false);
               alert("Run analysis first");
           }
        });

        $('#trip-attracted-radio').click(function() {
           if(taz_analyzed.length>0){
               if($('#trip-attracted-radio').is(':checked')){
                   max_score_basis = max_attracted;
                   for(x=0; x<visualize_analyzed_layers.length; x++){
                       visualize_analyzed_layers[x].setStyle(mystyle(taz_analyzed[x]));
                   }
               }
           }else{
               $('#trip-attracted-radio').prop("checked", false);
               alert("Run analysis first");
           }
        });

        function custom_index_length(arr){
            var count = 0;
            for(x in arr){
                count+=1;
            }
            return count;
        }

        function comrpressArray(arr){
            var compressedArray = [];
            for(x in arr){
                compressedArray.push(arr[x]);
            }
            return compressedArray;
        }

        $("#run-analysis-btn").click(function(){
            if(custom_index_length(amenity_files)>0 && custom_index_length(household_files)>0 && custom_index_length(trafficzone_files)){

                $("#overlay").css("display","inline");
                //$("#loader-modal").openModal({dismissible:false});
                $.ajax({
                    url: "{% url 'travel_demand_analysis:run_analysis' %}",
                    method: "POST",
                    data: {
                        "amenity_files[]" : comrpressArray(amenity_files),
                        "household_files[]" : comrpressArray(household_files),
                        "trafficzone_files[]": comrpressArray(trafficzone_files),
                        "zone_landuse_settings[]": comrpressArray(zone_landuse_settings)
                    },
                    success: function(data) {
                        $("#overlay").css("display","none");
                        zonal_od = data.zonal_od;
                        max_attracted = data.max_trip_attracted;
                        max_produced = data.max_trip_produced;
                        json_response = JSON.parse(data.taz_json);
                        console.log(json_response.length+" LENK");
                        $(json_response).each(function(key, data) {
                            taz_analyzed.push(data);
                            var zone_feature = JSON.parse(data.zone_feature);
                            visualize_analyzed_layers.push(L.geoJson(zone_feature, {style: {
                                fillColor: '#0000FF',
                                weight: 2,
                                opacity: 1,
                                color: 'white',
                                dashArray: '3',
                                fillOpacity: 0.7
                            }}).bindTooltip(getAnalyzedTooltip(zone_feature.properties.NAME_2, data)).addTo(mymap));
                            //console.log(key+":"+data.zone_polygon.__geom__);
                        });

                        refresh_zone_details();
                    },
                    failure: function(data) { 
                        alert('Error occurred.');
                    }
                }); 
            }else{
                alert("amenity or household files are empty!");
            }
        });

        function getAnalyzedTooltip(index, feature){
            return '<b>'+index+'</b>:<br>Total trips produced:'+feature.trips_produced+'<br>Total trips attracted:'+feature.trips_attracted;
        }

        function refresh_zone_details(){
            var zone_details = $("#table-zone-details").empty();
            for(x in taz_analyzed){
                var outerDiv = $("<div></div>").addClass("col s12 outer-detail-zone-entry");
                var tableDiv = $("<table></table>").addClass("left-summary-table bordered col s12").attr("style","height:350px;");
                var theadDiv = $("<thead></thead>");
                var trheadDiv = $("<tr></tr>");
                var th = $("<th></th>").html("Zone "+(parseInt(x)+1));

                th.appendTo(trheadDiv);
                trheadDiv.appendTo(theadDiv);
                theadDiv.appendTo(tableDiv);

                var tbodyDiv = $("<tbody></tbody>");
                var tr_container = $("<tr></tr>");
                var tdlabel = $("<td></td>").html("Amenities");
                var tdvalue = $("<td></td>").html(taz_analyzed[x].total_amenities);
                tdlabel.appendTo(tr_container);
                tdvalue.appendTo(tr_container);
                tr_container.appendTo(tbodyDiv);

                tr_container = $("<tr></tr>");
                tdlabel = $("<td></td>").html("Land Use");
                tdvalue = $("<td></td>").html(taz_analyzed[x].main_landuse);
                tdlabel.appendTo(tr_container);
                tdvalue.appendTo(tr_container);
                tr_container.appendTo(tbodyDiv);

                tr_container = $("<tr></tr>");
                tdlabel = $("<td></td>").html("Houses");
                tdvalue = $("<td></td>").html(taz_analyzed[x].no_hh);
                tdlabel.appendTo(tr_container);
                tdvalue.appendTo(tr_container);
                tr_container.appendTo(tbodyDiv);

                tr_container = $("<tr></tr>");
                tdlabel = $("<td></td>").html("Total Trips Produced");
                tdvalue = $("<td></td>").html(taz_analyzed[x].trips_produced);
                tdlabel.appendTo(tr_container);
                tdvalue.appendTo(tr_container);
                tr_container.appendTo(tbodyDiv);

                tr_container = $("<tr></tr>");
                tdlabel = $("<td></td>").html("Total Trips Attraction");
                tdvalue = $("<td></td>").html(taz_analyzed[x].trips_attracted);
                tdlabel.appendTo(tr_container);
                tdvalue.appendTo(tr_container);
                tr_container.appendTo(tbodyDiv);

                tbodyDiv.appendTo(tableDiv);
                tableDiv.appendTo(outerDiv);
                outerDiv.appendTo(zone_details);
            }
        }
        

        
        $("#add-amenity-file").click(function(){
            var ulDiv = $("#amenity-modal").find("#amenity-modal-ul");
            $(ulDiv).empty();
            {% if amenity_filenames %}
                {% for file in amenity_filenames%}
                var liDiv = $("<li></li>").addClass("collection-item");
                var inputDiv = $("<input />").addClass("with-gap").attr("name","file-checkbox")
                               .attr("id","{{file}}")
                               .attr("value","{{file}}")
                               .attr("type","checkbox");
                if(!(typeof amenity_files['{{file}}'] === 'undefined')){
                    $(inputDiv).attr("disabled","disabled").attr("checked","checked");
                }
                var labelDiv = $("<label></label>").addClass("black-text").attr("for","{{file}}")
                               .attr("name", "file-label").html("{{file}}");
                liDiv.append(inputDiv).append(labelDiv);
                ulDiv.append(liDiv);
                {% endfor %}
            {% else %}
                var h5Elem = $("<h5></h5>").addClass("center").html("There are currently no uploaded amenity files.");
                ulDiv.append(h5Elem);
            {% endif %}

            $("#amenity-modal").openModal();
        });

        $("#add-household-file").click(function(){
            var ulDiv = $("#household-modal").find("#household-modal-ul");
            $(ulDiv).empty();
            {% if household_filenames %}
                {% for file in household_filenames%}
                var liDiv = $("<li></li>").addClass("collection-item");
                var inputDiv = $("<input />").addClass("with-gap").attr("name","file-checkbox")
                               .attr("id","{{file}}")
                               .attr("value","{{file}}")
                               .attr("type","checkbox");
                if(!(typeof household_files['{{file}}'] === 'undefined')){
                    $(inputDiv).attr("disabled","disabled").attr("checked","checked");
                }
                var labelDiv = $("<label></label>").addClass("black-text").attr("for","{{file}}")
                               .attr("name", "file-label").html("{{file}}");
                liDiv.append(inputDiv).append(labelDiv);
                ulDiv.append(liDiv);
                {% endfor %}
            {% else %}
                var h5Elem = $("<h5></h5>").addClass("center").html("There are currently no uploaded household files.");
                ulDiv.append(h5Elem);
            {% endif %}

            $("#household-modal").openModal();
        });
        
        $("#add-trafficzone-file").click(function(){
            var ulDiv = $("#trafficzone-modal").find("#trafficzone-modal-ul");
            $(ulDiv).empty();
            {% if trafficzone_filenames %}
                {% for file in trafficzone_filenames%}
                var liDiv = $("<li></li>").addClass("collection-item");
                var inputDiv = $("<input />").addClass("with-gap").attr("name","file-checkbox")
                               .attr("id","{{file}}")
                               .attr("value","{{file}}")
                               .attr("type","checkbox");
                if(!(typeof trafficzone_files['{{file}}'] === 'undefined')){
                    $(inputDiv).attr("disabled","disabled").attr("checked","checked");
                }
                var labelDiv = $("<label></label>").addClass("black-text").attr("for","{{file}}")
                               .attr("name", "file-label").html("{{file}}");
                liDiv.append(inputDiv).append(labelDiv);
                ulDiv.append(liDiv);
                {% endfor %}
            {% else %}
                var h5Elem = $("<h5></h5>").addClass("center").html("There are currently no uploaded trafficzone files.");
                ulDiv.append(h5Elem);
            {% endif %}

            $("#trafficzone-modal").openModal();
        });
        
        $("#edit-landuse").click(function(){
            $("#edit-landuse-modal").openModal({dismissible:false});
        });
        
        function initializeLanduseModal(){
            var ulDiv = $("#edit-landuse-modal").find("#edit-landuse-modal-ul");
            $(ulDiv).empty();
            
            var selectDiv = $("<select></select>").addClass("browser-default col s6").attr("style", "height:2rem").attr("name","landuse-selector");
            var option = $("<option></option>").attr("disabled","disabled").attr("selected","selected").val("invalid").html("Select land use");
            option.appendTo(selectDiv);
            for(var x=0; x<landuse_categories.length; x++){
                var option = $("<option></option>").val(landuse_categories[x]).html(landuse_categories[x]);
                option.appendTo(selectDiv);
            }
            for(var x=0; x<traffic_analysis_zones_layers.length; x++){
                var liDiv = $("<li></li>").addClass("collection-item").addClass("row");
                var nameDiv = $("<div></div>").addClass("col s6").html("Zone "+(x+1));
                nameDiv.appendTo(liDiv);
                $(selectDiv).clone().appendTo(liDiv);
                liDiv.appendTo(ulDiv);
            }
        }

        $("#edit-landuse-modal-ok-btn").click(function() {
            var bool_landuse = 0;
            selectDivs = $("#edit-landuse-modal").find("[name='landuse-selector']");
            for(var x=0; x<zone_landuse_settings.length; x++){
                val_lu = $(selectDivs[x]).val();
                if(val_lu == null){
                    bool_landuse = 1;
                    break;
                }else{
                    zone_landuse_settings[x] = val_lu;
                }
            }
            
            if(bool_landuse == 0){
                $("#edit-landuse-modal").closeModal();
            }else{
                bool_landuse = 0;
                alert("Not all zones have land use.");
            }
        });

        $("#household-modal-ok-btn").click(function() {
            var file_rows = $("#household-modal").find("[name='file-checkbox']");
                for(var i=0; i<file_rows.length; i++){
                    var filename = $(file_rows[i]).val();
                    if($(file_rows[i]).is(':checked')){
                        if(typeof household_files[filename] === 'undefined'){
                            count = 0;
                            $.ajax({
                                url: "{% url 'travel_demand_analysis:analysis_add_household' %}",
                                method: "POST",
                                data: {
                                    "household_filename" : filename
                                },
                                success: function(data) {
                                    alert("WENT HOUSEHOLD");
                                    /*filename = data.household_filename;
                                    count = data.no_households;
                                    household_files.push(filename);
                                    household_summaries.push(count);
                                    refresh_household_list();*/

                                    filename = data.household_filename;
                                    count = data.no_households;
                                    alert("count: "+count);
                                    household_files[filename] = filename;
                                    household_summaries[filename] = count;
                                    //households_json = JSON.parse(data.households_json);

                                    //var households_marker = [];
                                    //$(households_json).each(function(key, data) {
                                    //    households_marker.push(data);
                                    //});
                                    //visualize_households[filename] = households_marker;
                                    refresh_household_list();
                                    alert("ENDED HOUSEHOLD");
                                },
                                failure: function(data) { 
                                    alert('Error occurred.');
                                }
                            }); 
                        }
                    }else{
                        if(household_files.indexOf(filename) != -1){
                            removeFromArray(household_files, filename);
                            household_summaries.splice(index, 1);
                            refresh_household_list();
                        }
                    }
                }
        });

        $("#trafficzone-modal-ok-btn").click(function() {
            var file_rows = $("#trafficzone-modal").find("[name='file-checkbox']");
            for(var i=0; i<file_rows.length; i++){
                var filename = $(file_rows[i]).val();
                if($(file_rows[i]).is(':checked')){
                    if(typeof trafficzone_files[filename] === 'undefined'){
                        count = 0;
                        $.ajax({
                            url: "{% url 'travel_demand_analysis:analysis_add_trafficzone' %}",
                            method: "POST",
                            data: {
                                "trafficzone_filename" : filename
                            },
                            success: function(data) {
                                alert("TRAFFICZONE WENT");
                                /*filename = data.trafficzone_filename;
                                count = data.no_trafficzones;
                                trafficzone_files.push(filename);
                                json_response = JSON.parse(data.zone_geojson);
                                console.log(json_response.features.length+" LENK");
                                $(json_response.features).each(function(key, data) {
                                    data.properties.trips = 0;
                                    alert(data.type);
                                    traffic_analysis_zones_layers.push(L.geoJson(data, {style: {
                                        fillColor: '#FED976',
                                        weight: 2,
                                        opacity: 1,
                                        color: 'white',
                                        dashArray: '3',
                                        fillOpacity: 0.7
                                    }}).bindTooltip('<b>Zone #'+(traffic_analysis_zones_layers.length+1)+'</b>').addTo(mymap));
                                });*/

                                filename = data.trafficzone_filename;
                                count = data.no_trafficzones;
                                trafficzone_files[filename] = filename;
                                trafficzone_summaries[filename] = count;
                                trafficzones_json = JSON.parse(data.zone_geojson);

                                var trafficzones_marker = [];
                                $(trafficzones_json.features).each(function(key, data) {
                                    trafficzones_marker.push(data);
                                });
                                visualize_trafficzones[filename] = trafficzones_marker;
                                refresh_trafficzone_list();
                                initializeLanduseModal();
                                alert("DONE WENT");
                            },
                            failure: function(data) {
                                alert('Error occurred.');
                            }
                        });
                    }
                }else{
                    if(trafficzone_files.indexOf(filename) != -1){
                        removeFromArray(trafficzone_files, filename);
                        trafficzone_summaries.splice(index, 1);
                        refresh_trafficzone_list();
                    }
                }
            }
        });
         
        function getColor_attraction(d) {
            console.log("currval:"+d+" maxscore:"+max_score_basis);
            console.log((max_score_basis *0.9)+","+(max_score_basis *0.65)+","+(max_score_basis *0.3)+","+(max_score_basis *0.3));
            return d > (max_score_basis *0.9) ? '#FF0AE7' :
                   d > (max_score_basis *0.65)  ? '#B816C6' :
                   d > (max_score_basis *0.3)  ? '#59279C' :
                              '#13347C';
        }

        function getColor_production(d) {
            console.log("currval:"+d+" maxscore:"+max_score_basis);
            console.log((max_score_basis *0.9)+","+(max_score_basis *0.65)+","+(max_score_basis *0.3)+","+(max_score_basis *0.3));
            return d > (max_score_basis *0.9) ? '#FF210F' :
                   d > (max_score_basis *0.65)  ? '#FC612E' :
                   d > (max_score_basis *0.3)  ? '#FAB857' :
                              '#F8F977';
        }


        function mystyle(feature) {
            if(max_score_basis == max_produced){
                alert("COLOR PRODUCED");
                return {
                    fillColor: getColor_production(feature.trips_produced),
                    weight: 2,
                    opacity: 1,
                    color: 'white',
                    dashArray: '3',
                    fillOpacity: 0.7
                };
            }else{
                alert("COLOR ATTRACTED");
                return {
                    fillColor: getColor_attraction(feature.trips_attracted),
                    weight: 2,
                    opacity: 1,
                    color: 'white',
                    dashArray: '3',
                    fillOpacity: 0.7
                };
            }
        }

        function computeTotal(arr){
            total = 0;
            for(x in arr){
                total += arr[x];
            }
            return total;
        }
        
        $("#amenity-modal-ok-btn").click(function() {
            var file_rows = $("#amenity-modal").find("[name='file-checkbox']");
                for(var i=0; i<file_rows.length; i++){
                    var filename = $(file_rows[i]).val();
                    if($(file_rows[i]).is(':checked')){
                        if(typeof amenity_files[filename] === 'undefined'){
                            count = 0;
                            $.ajax({
                                url: "{% url 'travel_demand_analysis:analysis_add_amenity' %}",
                                method: "POST",
                                data: {
                                    "amenity_filename" : filename
                                },
                                success: function(data) {
                                    filename = data.amenity_filename;
                                    count = data.no_amenities;
                                    amenity_files[filename] = filename;
                                    amenity_summaries[filename] = count;
                                    amenities_json = JSON.parse(data.amenities_json);

                                    /*var amenities_marker = [];
                                    $(amenities_json).each(function(key, data) {
                                        amenities_marker.push(data);
                                    });
                                    */

                                    var amenity_layers = []

                                    var eLayer = L.geoJson(amenities_json,{
                                        onEachFeature: function(feature,layer){
                                            switch(feature.properties.amenity_type)
                                            {
                                                case "sustenance": layer.setIcon(new SustenanceMarker()); break;
                                                case "education":  layer.setIcon(new EducationMarker()); break;
                                                case "transport":  layer.setIcon(new TransportMarker()); break;
                                                case "healthcare": layer.setIcon(new HealthcareMarker()); break;
                                                case "finance": layer.setIcon(new FinanceMarker()); break;
                                                case "commerce": layer.setIcon(new CommerceMarker()); break;
                                                case "entertainment": layer.setIcon(new EntertainmentMarker()); break;
                                                default: layer.setIcon(new OtherMarker()); break;
                                            }
                                        }
                                    });

                                    //visualize_amenities[filename] = eLayer;
                                    visualize_amenity_layers[filename] = eLayer;
                                    refresh_amenity_list();
                                },
                                failure: function(data) { 
                                    alert('Error occurred.');
                                }
                            }); 
                        }
                    }else{
                        if(amenity_files.indexOf(filename) != -1){
                            index = removeFromArray(amenity_files, filename);
                            amenity_summaries.splice(index, 1);
                            refresh_amenity_list();
                            //alert("Amenities total: "+computeTotal(amenity_summaries));
                        }
                    }
                }
         });

        function visualize_amenity(inputElem){
            var filename = $(inputElem).val();
            if($(inputElem).is(':checked')){
                /*var amenity_json = visualize_amenities[filename];
                var amenity_layer_list = [];
                for(x in amenity_json){
                    amenity_layer_list.push(L.geoJSON(amenity_json[x]).addTo(mymap));
                }*/
                visualize_amenity_layers[filename].addTo(mymap);// = amenity_layer_list;
            }else{
                var amenity_layer_list = visualize_amenity_layers[filename];
                for(x in amenity_layer_list){
                    mymap.removeLayer(amenity_layer_list[x]);
                }
                delete visualize_amenity_layers[ filename ];
            }
        }

        function visualize_trafficzone(inputElem){
            alert("pressed input elem");
            var filename = $(inputElem).val();
            if($(inputElem).is(':checked')){
                var trafficzone_json = visualize_trafficzones[filename];
                var trafficzone_layer_list = [];
                for(x in trafficzone_json){
                    trafficzone_layer_list.push(L.geoJSON(trafficzone_json[x], {style: {
                                        fillColor: '#FED976',
                                        weight: 2,
                                        opacity: 1,
                                        color: 'white',
                                        dashArray: '3',
                                        fillOpacity: 0.7
                                    }}).bindTooltip('<b>Zone #'+(trafficzone_json[x].properties.NAME_2)+'</b>').addTo(mymap));
                }
                visualize_trafficzone_layers[filename] = trafficzone_layer_list;
            }else{
                var trafficzone_layer_list = visualize_trafficzone_layers[filename];
                for(x in trafficzone_layer_list){
                    mymap.removeLayer(trafficzone_layer_list[x]);
                }
                delete visualize_trafficzone_layers[ filename ];
            }
        }

        function refresh_amenity_list(){
            $("#amenity-summary").html(computeTotal(amenity_summaries));
            var mainDiv = $('#amenity-included-files');
            $(mainDiv).empty();
            {% for file in amenity_filenames %}
            if(!(typeof amenity_files['{{file}}'] === 'undefined')){
                var listDiv = $("<li></li>").addClass("collection-item row").attr("style","padding-left:10px !important; padding-right:10px !important;").attr("name", "{{file}}");
                var inputDiv = $("<input />").addClass("with-gap visualize-amenities").attr("style","margin:0 !important; padding:0 !important;").attr("name","file-checkbox")
                               .attr("id","{{file}}")
                               .attr("value","{{file}}")
                               .attr("type","checkbox");
                $(inputDiv).on("click", function(event){
                    visualize_amenity($(this));
                });
                if(!(typeof visualize_amenity_layers['{{file}}'] === 'undefined')){
                    $(inputDiv).prop("checked",true);
                }

                var pDiv = $("<label></label>").addClass("col s10 truncate-file").attr("style","top:0rem !important;padding-left:30px !important;").attr("for","{{file}}").html('{{file}}')
                var aDiv = $("<a></a>").addClass("secondary-content col s2").attr("onclick","deletefile('amenity','{{file}}')");
                var iDiv = $("<i></i>").addClass("black-text material-icons").html('delete');
                //var deleteBtn = $("<button></button>").addClass("col s4 btn waves-effect").html("delete").attr("onclick","deletefile('amenity','{{file}}')");
                aDiv.append(iDiv);
                listDiv.append(inputDiv);
                listDiv.append(pDiv);
                listDiv.append(aDiv);
                mainDiv.append(listDiv);
            }
            {% endfor %}

            /*for(x in amenities_json){
                L.geoJSON(amenities_json[x]).addTo(mymap);
            }*/

            $('#amenity-modal').closeModal();
        }

        
        function refresh_trafficzone_list(){
            $("#trafficzone-summary").html(zone_landuse_settings.length);
            var mainDiv = $('#trafficzone-included-files');
            $(mainDiv).empty();
            {% for file in trafficzone_filenames %}
            if(!(typeof trafficzone_files['{{file}}'] === 'undefined')){
                var listDiv = $("<li></li>").addClass("collection-item row").attr("style","padding-left:10px !important; padding-right:10px !important;").attr("name", "{{file}}");
                var inputDiv = $("<input />").addClass("with-gap").attr("style","margin:0 !important; padding:0 !important;").attr("name","file-checkbox")
                               .attr("id","{{file}}")
                               .attr("value","{{file}}")
                               .attr("type","checkbox");
                $(inputDiv).on("click", function(event){
                    visualize_trafficzone($(this));
                });
                if(!(typeof visualize_trafficzone_layers['{{file}}'] === 'undefined')){
                    $(inputDiv).prop("checked",true);
                }

                var pDiv = $("<label></label>").addClass("col s10 truncate-file").attr("style","top:0rem !important;padding-left:30px !important;").attr("for","{{file}}").html('{{file}}')
                var aDiv = $("<a></a>").addClass("secondary-content col s2").attr("onclick","deletefile('trafficzone','{{file}}')");
                var iDiv = $("<i></i>").addClass("black-text material-icons").html('delete');
                //var deleteBtn = $("<button></button>").addClass("col s4 btn waves-effect").html("delete").attr("onclick","deletefile('amenity','{{file}}')");
                aDiv.append(iDiv);
                listDiv.append(inputDiv);
                listDiv.append(pDiv);
                listDiv.append(aDiv);
                mainDiv.append(listDiv);
            }
            {% endfor %}
            $('#trafficzone-modal').closeModal();
        }

        function refresh_household_list(){
            $("#household-summary").html(computeTotal(household_summaries));
            var mainDiv = $('#household-included-files');
            $(mainDiv).empty();
            {% for file in household_filenames %}
            if(!(typeof household_files['{{file}}'] === 'undefined')){
                var listDiv = $("<li></li>").addClass("collection-item row").attr("style","padding-left:10px !important; padding-right:10px !important;").attr("name", "{{file}}");
                var inputDiv = $("<input />").addClass("with-gap").attr("style","margin:0 !important; padding:0 !important;").attr("name","file-checkbox")
                               .attr("id","{{file}}")
                               .attr("value","{{file}}")
                               .attr("type","checkbox");
                var pDiv = $("<label></label>").addClass("col s10 truncate-file").attr("style","top:0rem !important;padding-left:30px !important;").attr("for","{{file}}").html('{{file}}')
                var aDiv = $("<a></a>").addClass("secondary-content col s2").attr("onclick","deletefile('household','{{file}}')");
                var iDiv = $("<i></i>").addClass("black-text material-icons").html('delete');
                //var deleteBtn = $("<button></button>").addClass("col s4 btn waves-effect").html("delete").attr("onclick","deletefile('amenity','{{file}}')");
                aDiv.append(iDiv);
                listDiv.append(inputDiv);
                listDiv.append(pDiv);
                listDiv.append(aDiv);
                mainDiv.append(listDiv);
            }
            {% endfor %}
            $('#household-modal').closeModal();
        }


        function deletefile(type, filename){
            to_delete = new File(filename, type);
            $("#delete-modal").find("[name='delete-modal-message']").html(filename+" will be removed. Are you sure?");
            $("#delete-modal").openModal();
        }


        function removeFromArray(array, item) {
            var index = array.indexOf(item);
            array.splice(index, 1);
            return index;
        }

        function File(name, type) {
            this.name = name;
            this.type = type;
        }
        
        //function TrafficAnalysisZone(zone_no, )

        $("#delete-file").click(function(){
            type = to_delete.type;
            filename = to_delete.name;
            alert(type+":"+filename);
            if(type=="amenity"){
                if(!(typeof visualize_amenity_layers[filename] === 'undefined')){
                    var amenity_layer_list = visualize_amenity_layers[filename];
                    for(x in amenity_layer_list){
                        mymap.removeLayer(amenity_layer_list[x]);
                    }
                }
                delete amenity_summaries[ filename ];
                delete amenity_files[ filename ];
                delete visualize_amenity_layers[ filename ];
                delete visualize_amenities[ filename ];
                $("#amenity-summary").html(computeTotal(amenity_summaries));
                $("#amenity-included-files").find("[name='"+filename+"']").remove();
            }else if(type=="household"){
                delete household_summaries[ filename ];
                delete household_files[ filename ];
                delete visualize_household_layers[ filename ];
                delete visualize_households[ filename ];
                $("#household-summary").html(computeTotal(household_summaries));
                $("#household-included-files").find("[name='"+filename+"']").remove();
            }else if(type=="trafficzone"){
                if(!(typeof visualize_trafficzone_layers[filename] === 'undefined')){
                    var trafficzone_layer_list = visualize_trafficzone_layers[filename];
                    for(x in trafficzone_layer_list){
                        mymap.removeLayer(trafficzone_layer_list[x]);
                    }
                }
                delete trafficzone_summaries[ filename ];
                delete trafficzone_files[ filename ];
                delete visualize_trafficzone_layers[ filename ];
                delete visualize_trafficzones[ filename ];
                $("#trafficzone-summary").html(computeTotal(trafficzone_summaries));
                $("#trafficzone-included-files").find("[name='"+filename+"']").remove();
            }
            $("#delete-modal").closeModal();
        });

        //END OF XGB SCRIPT

        /*$("#runanalysis").click(function(){

            $("#file-modal").openModal({
                ready: function(){

                },
                complete: function(){

                }
            });
        });*/
    
        var originalContent;

        function showModify(){
          originalContent = $('#side-nav-holder').html();
          var modifyContent = $('#modify-content').html()
          $('#side-nav-holder').fadeOut('slow', function() {
              $('#side-nav-holder').replaceWith("<div id='side-nav-holder' class='side-nav-bg col s3' style='display:none'>" + modifyContent + "</div>");
              $('#side-nav-holder').fadeIn('slow');
          });
        }

        function showOriginal(){
          $('#side-nav-holder').fadeOut('slow', function() {
              $('#side-nav-holder').replaceWith("<div id='side-nav-holder' class='side-nav-bg col s3' style='display:none'>" + originalContent + "</div>");
              $('#side-nav-holder').fadeIn('slow');
          });
        }


        function copyToClipboard(text) {
          window.prompt("Copy Lat/Long values to clipboard: Ctrl+C, Enter", text);
        }

        function addAmenity(){
          $('#amenity-tbody').append('<tr><td><input placeholder="Placeholder" type="text" style="height:auto !important; font-size:11px !important;text-align: center"></td><td><input placeholder="Placeholder" type="text" style="height:auto !important; font-size:11px !important;text-align: center"></td><td><input placeholder="Placeholder" type="text" style="height:auto !important; font-size:11px !important;text-align: center"></td><td><input placeholder="Placeholder" type="text" style="height:auto !important; font-size:11px !important;text-align: center"></td></tr>');

          var mydiv = $("#amenity-tbody");
          mydiv.scrollTop(mydiv.prop("scrollHeight"));
        }

    
        /******************************* MAP *************************************/
        
        var mymap = L.map('mapid', {editable: true}).setView([14.5995, 120.9842], 15);

        /*mymap.on('click', function(e) {
            copyToClipboard(e.latlng.lat + ", " + e.latlng.lng);
        });*/
        
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery  <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18,
            id: 'xgb7.1jd5j7o2',
            accessToken: 'pk.eyJ1IjoieGdiNyIsImEiOiJjaXR6dGgxaHEwZnJjMm9vODRjbXk2NTczIn0.JGHOHRx1UpItrRAG1B0Fyw'
        }).addTo(mymap);

        /************** HEAT MAP ************************/


                // don't forget to include leaflet-heatmap.js
            var quakePoints = [{lat: 14.600943832220155, lng:120.97576087340713, count: 3},{lat: 14.600435096555684, lng:120.975734051317, count: 1},{lat: 14.600243022580464, lng:120.97485428676009, count: 3} ]
            ;

    
        /************************ EDIT SUTFF ****************/


        var amenities = new L.LayerGroup();
        var drawnItems = new L.FeatureGroup();
        drawnItems.addLayer(amenities);
        mymap.addLayer(drawnItems);
        /*mymap.on('click', function(e) {
               L.marker([e.latlng.lat, e.latlng.lng]).addTo(mymap);
            });*/



    
        /******************* TOOLBAR STUFF **********************/

        var heat = L.heatLayer(quakePoints, {radius: 20,
                                        blur: 20,
                                        maxZoom: 17,
                                        gradient: {
                                          0.2: '#ffffb2',
                                          0.4: '#fd8d3c',
                                          0.6: '#fd8d3c',
                                          0.8: '#f03b20',
                                          1: '#bd0026'
                                          },
                                        }).addTo(mymap);

        var MyCustomMarker = L.Icon.extend({
            options: {
                shadowUrl: null,
                iconAnchor: new L.Point(12, 12),
                iconSize: new L.Point(24, 24),
                iconUrl: "{% static 'leaflet/images/marker-icon.png' %}"
            }
        });

        var options = {
            draw: {
                polyline: false,
                polygon: false,
                circle: false,
                rectangle: false,
                marker: false
            },
            edit: false
        };

        var drawControl = new L.Control.Draw(options);
        mymap.addControl(drawControl);

           mymap.on(L.Draw.Event.Created, function (e) {
                var type = e.layerType,
                    layer = e.layer;

                if (type === 'marker') {
                    layer.bindPopup('A popup!');

                }

                drawnItems.addLayer(layer);
           });

        var OtherMarker = L.Icon.extend({
        options: {
            shadowUrl: null,
            iconAnchor: new L.Point(12, 12),
            iconSize: new L.Point(24, 24),
            iconUrl: "{% static 'leaflet/images/marker-icon.png' %}"
        }
    });

    var SustenanceMarker = L.Icon.extend({
        options: {
            shadowUrl: null,
            iconAnchor: new L.Point(12, 12),
            iconSize: new L.Point(24, 24),
            iconUrl: "{% static 'leaflet/images/amenity_sustenance.png' %}"
        }
    });

    var EducationMarker = L.Icon.extend({
        options: {
            shadowUrl: null,
            iconAnchor: new L.Point(12, 12),
            iconSize: new L.Point(24, 24),
            iconUrl: "{% static 'leaflet/images/amenity_education.png' %}"
        }
    });

    var TransportMarker = L.Icon.extend({
        options: {
            shadowUrl: null,
            iconAnchor: new L.Point(12, 12),
            iconSize: new L.Point(24, 24),
            iconUrl: "{% static 'leaflet/images/amenity_transportation.png' %}"
        }
    });

    var HealthcareMarker = L.Icon.extend({
        options: {
            shadowUrl: null,
            iconAnchor: new L.Point(12, 12),
            iconSize: new L.Point(24, 24),
            iconUrl: "{% static 'leaflet/images/amenity_healthcare.png' %}"
        }
    });

    var FinanceMarker = L.Icon.extend({
        options: {
            shadowUrl: null,
            iconAnchor: new L.Point(12, 12),
            iconSize: new L.Point(24, 24),
            iconUrl: "{% static 'leaflet/images/amenity_finance.png' %}"
        }
    });

    var CommerceMarker = L.Icon.extend({
        options: {
            shadowUrl: null,
            iconAnchor: new L.Point(12, 12),
            iconSize: new L.Point(24, 24),
            iconUrl: "{% static 'leaflet/images/amenity_commerce.png' %}"
        }
    });

    var EntertainmentMarker = L.Icon.extend({
        options: {
            shadowUrl: null,
            iconAnchor: new L.Point(12, 12),
            iconSize: new L.Point(24, 24),
            iconUrl: "{% static 'leaflet/images/amenity_entertainment.png' %}"
        }
    });

    


</script>


</body>
</html>